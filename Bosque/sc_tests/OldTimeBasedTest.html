<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="824.48">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #606060}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #007300}
p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #bf0000}
p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Monaco}
span.s1 {color: #000000}
span.s2 {color: #0000bf}
span.s3 {color: #007300}
span.s4 {color: #606060}
span.s5 {font: 10.0px Monaco}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1">g.quit;</p>
<p class="p1">g.boot;</p>
<p class="p2"><br></p>
<p class="p1">(</p>
<p class="p3"><span class="s1">g.updateClasses( </span>"file:///Users/rutz/Documents/workspace/TimeBased/TimeBased.jar"<span class="s1"> );</span></p>
<p class="p1">t = <span class="s2">Trail</span>( <span class="s2">Trail</span>.kTouchSplit );</p>
<p class="p4"><span class="s1">~jt = </span><span class="s2">JavaObject</span><span class="s1">( </span>'de.sciss.timebased.RegionTrail'<span class="s1">, g );</span></p>
<p class="p2"><br></p>
<p class="p1">l = (<span class="s3">\trailModified</span>: { <span class="s2">arg</span> l, e; e.postln; ~e = e; });</p>
<p class="p1">t.addListener( l );</p>
<p class="p5">//t.removeListener( l );</p>
<p class="p1">r = <span class="s2">RegionStake</span>( <span class="s2">Span</span>( 100, 1000 ), <span class="s4">"schoko"</span> );</p>
<p class="p1">~js = <span class="s2">JavaObject</span>( <span class="s3">'de.sciss.io.Span'</span>, g, 100, 1000 );</p>
<p class="p3"><span class="s1">~faf = </span><span class="s2">ForestAudioFile</span><span class="s1">( </span>"/Users/rutz/scwork/ping/tapes1/msg3.aif"<span class="s1"> );</span></p>
<p class="p1">~jr = <span class="s2">JavaObject</span>( <span class="s3">'de.sciss.timebased.ForestAudioRegionStake'</span>, g, ~js, <span class="s4">"schoko"</span>, <span class="s2">Color</span>.blue, <span class="s2">JavaObject</span>( <span class="s3">'de.sciss.timebased.Fade'</span>, g, 0, 250, 0.0 ), <span class="s2">nil</span>, 1.0, ~faf.view );</p>
<p class="p5">//t.clear;</p>
<p class="p1">t.add( t, r, <span class="s2">nil</span> );</p>
<p class="p1">~jt.add( ~jt, ~jr );</p>
<p class="p2"><br></p>
<p class="p1"><span class="s2">GUI</span>.swing;</p>
<p class="p1">w = <span class="s2">GUI</span>.window.new( <span class="s4">"Trail"</span> );</p>
<p class="p4"><span class="s1">~tv = </span><span class="s2">JavaObject</span><span class="s1">( </span>'de.sciss.timebased.gui.TrailView'<span class="s1">, g );</span></p>
<p class="p1">v = <span class="s2">JSCPlugView</span>( w, w.view.bounds.insetAll( 0, 22, 0, 22 ), ~tv ).resize_( 5 );</p>
<p class="p1">~tv.setTrail( ~jt );</p>
<p class="p1">~js2 = <span class="s2">JavaObject</span>( <span class="s3">'de.sciss.io.Span'</span>, g, 0, 10000 );</p>
<p class="p5">//~tv.setViewSpan( ~js2 );</p>
<p class="p5">//~tv.setBackground( Color.red );</p>
<p class="p5">//~ggScroll = GUI.scrollBar.new( w, Rect( 0, w.view.bounds.height - 20, w.view.bounds.width, 20 ));</p>
<p class="p1">~ggScroll = <span class="s2">JSCScrollBar</span>.new( w, <span class="s2">Rect</span>( 0, w.view.bounds.height - 16, w.view.bounds.width - 16, 16 )).resize_( 8 );</p>
<p class="p1">~totalSpan = <span class="s2">Span</span>( 0, 44100 );</p>
<p class="p1">~viewSpan = <span class="s2">Span</span>( 0, 10000 );</p>
<p class="p1">~funcUpdScroll = { ~ggScroll.value_( ~viewSpan.start / ~totalSpan.getLength ).extent_( ~viewSpan.getLength / ~totalSpan.getLength );};</p>
<p class="p1">~funcUpdScroll.value;</p>
<p class="p1">~sampleRate = 44100;</p>
<p class="p1">~ggScroll.action = { <span class="s2">arg</span> b; ~viewSpan = <span class="s2">Span</span>( b.value * ~totalSpan.getLength, (b.value + b.extent) * ~totalSpan.getLength ); ~tv.setViewSpan( <span class="s2">JavaObject</span>( <span class="s3">'de.sciss.io.Span'</span>, g, ~viewSpan.start, ~viewSpan.stop )); g.sendMsg( <span class="s3">'/local'</span>, <span class="s3">\space</span>, <span class="s3">'['</span>, <span class="s3">'/method'</span>, <span class="s3">'de.sciss.gui.VectorSpace'</span>, <span class="s3">\createLinSpace</span>, ~viewSpan.start / ~sampleRate, ~viewSpan.stop / ~sampleRate, 0.0, 1.0, <span class="s4">""</span>, <span class="s4">""</span>, <span class="s4">""</span>, <span class="s4">""</span>, <span class="s3">']'</span> ); g.sendMsg( <span class="s3">'/method'</span>, ~jAxis.id, <span class="s3">\setSpace</span>, <span class="s3">'['</span>, <span class="s3">'/ref'</span>, <span class="s3">\space</span>, <span class="s3">']'</span> ); };</p>
<p class="p2"><br></p>
<p class="p1">w.view.keyDownAction = { <span class="s2">arg</span> view, char, modifiers, lala, key;</p>
<p class="p1"><span class="Apple-tab-span">	</span>if( (modifiers &amp; <span class="s5">262144) != 0, {</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>switch( key,</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>37, {</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>if( ~ggScroll.extent &lt; 1, {</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>~ggScroll.extent = ~ggScroll.extent * 1.5;</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>~ggScroll.doAction;</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>})},</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>39, {</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>if( ~ggScroll.extent &gt; (1/1000), {</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>~ggScroll.extent = ~ggScroll.extent / 1.5;</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>~ggScroll.doAction;</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>})}</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>);</p>
<p class="p6"><span class="Apple-tab-span">	</span>})</p>
<p class="p6">};</p>
<p class="p2"><br></p>
<p class="p4"><span class="s1">~jAxis = </span><span class="s2">JavaObject</span><span class="s1">( </span>'de.sciss.timebased.gui.Axis'<span class="s1">, g, 0, 4 );</span></p>
<p class="p1">~ggAxis = <span class="s2">JSCPlugView</span>( w, <span class="s2">Rect</span>( 0, 0, w.view.bounds.width, 15 ), ~jAxis ).resize_( 2 );</p>
<p class="p5">//~jSpc = JavaObject.getClass( 'de.sciss.gui.VectorSpace', g );</p>
<p class="p5">//JavaObject.newFrom( ~jSpc, \createLinSpace, 0.0, 60.0, 0.0, 0.0, "", "", "", "" );</p>
<p class="p2"><br></p>
<p class="p1">~r2 = <span class="s2">RegionStake</span>( <span class="s2">Span</span>( 2000, 5000 ), <span class="s4">"gaga"</span> );</p>
<p class="p1">~js2 = <span class="s2">JavaObject</span>( <span class="s3">'de.sciss.io.Span'</span>, g, 2000, 5000 );</p>
<p class="p1">~jr2 = <span class="s2">JavaObject</span>( <span class="s3">'de.sciss.timebased.ForestRegionStake'</span>, g, ~js2, <span class="s4">"gaga"</span>, <span class="s2">Color</span>.green( 0.6 ), <span class="s2">nil</span>, <span class="s2">nil</span>, 1.0 );</p>
<p class="p5">//t.clear;</p>
<p class="p1">t.add( t, ~r2, <span class="s2">nil</span> );</p>
<p class="p1">~jt.add( ~jt, ~jr2 );</p>
<p class="p2"><br></p>
<p class="p5">//~tv.setViewSpan( JavaObject( 'de.sciss.io.Span', g, 500, 4000 ));</p>
<p class="p5">//fork { 20.do({ arg i; ~tv.setViewSpan( JavaObject( 'de.sciss.io.Span', g, 500, 3000 + (i * 200) )); 0.05.wait })};</p>
<p class="p2"><br></p>
<p class="p1">~r3 = <span class="s2">RegionStake</span>( <span class="s2">Span</span>( 6000, 8000 ), <span class="s4">"Snd1"</span> );</p>
<p class="p1">~js3 = <span class="s2">JavaObject</span>( <span class="s3">'de.sciss.io.Span'</span>, g, 6000, 8000 );</p>
<p class="p1">~jr3 = <span class="s2">JavaObject</span>( <span class="s3">'de.sciss.timebased.ForestRegionStake'</span>, g, ~js3, <span class="s4">"Snd1"</span>, <span class="s2">Color</span>( 0.7, 0.0, 0.4 ), <span class="s2">nil</span>, <span class="s2">nil</span>, 1.0 );</p>
<p class="p5">//t.clear;</p>
<p class="p1">t.add( t, ~r3, <span class="s2">nil</span> );</p>
<p class="p1">~jt.add( ~jt, ~jr3 );</p>
<p class="p2"><br></p>
<p class="p1">~fnt = <span class="s2">GUI</span>.font.new( <span class="s4">"Helvetica"</span>, 10 );</p>
<p class="p1">~jAxis.setFont( ~fnt );</p>
<p class="p1">~tv.setFont( ~fnt );</p>
<p class="p2"><br></p>
<p class="p1">w.front;</p>
<p class="p1">~ggScroll.doAction;</p>
<p class="p1">w.view.focus;</p>
<p class="p1">)</p>
<p class="p2"><br></p>
<p class="p5">////////////////////</p>
<p class="p2"><br></p>
<p class="p5">//f = { arg view, x, y, modif, button, clicks; x = x - view.bounds.left; y = y - view.bounds.top; [ x, y ].postln };</p>
<p class="p1">v.mouseDownAction = { <span class="s2">arg</span> view, x, y, modif, button, clicks; <span class="s2">var</span> bounds, frame, stake; bounds = view.bounds; x = x - bounds.left; y = y - bounds.top; frame = (x / bounds.width * ~viewSpan.getLength + ~viewSpan.start + 0.5).asInteger; stake = t.getLeftMost( t.indexOfPos( frame )); if( stake.notNil and: { stake.getSpan.stop &gt; frame }, { [ <span class="s4">"Hit"</span>, stake.name ].postln }); };</p>
<p class="p5">//v.mouseUpAction = nil;</p>
<p class="p2"><br></p>
<p class="p5">//</p>
</body>
</html>
